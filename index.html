<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>ðŸ“ˆ</title>
</head>

<body>
    <h1 class="display-1 text-center">Interactive Econ Stuff ðŸ“ˆ</h1>
    <h1 class="display-3 text-center">By Vincent Zhou</h1>

    <hr class="my-4" style="width: 75%">

    <div class="jumbotron" style="width: 75%; margin:auto;">
        <h1 class="display-4">Table of Contents</h1>
        <p class="lead">A bunch of economics graphs with interactive sliders that show animations</p>
        <hr class="my-4">
        <div class="list-group">
            <a href="#supply_vs_demand_place" class="list-group-item list-group-item-action">Supply vs Demand Graph</a>
            <a href="#cost_curve_place" class="list-group-item list-group-item-action">Cost Curve <span class="badge badge-secondary">New</span></a>
        </div>
    </div>

    <hr class="my-4" style="width: 75%">

    <h1 class="display-4 text-center" id="supply_vs_demand_place">Supply vs Demand</h1>
    <div class="graph">
        <canvas id="supply_vs_demand_chart" width="1000" height="600"></canvas>
    </div>

    <!--     
    <div class="controls">
        <p id="demand_shift">Demand Shift: 0</p>
        <input class="slider" id="demand_slider" type="range" min="-20" max="20" value="0">
        <br>
        <p id="supply_shift">Supply Shift: 0</p>
        <input class="slider" id="supply_slider" type="range" min="-20" max="20" value="0">
    </div> 
    -->

    <div class="card controls">
        <h5 class="card-header">Controls</h5>
        <div class="card-body">
            <p id="demand_shift">Demand Shift: 0</p>
            <input class="slider" id="demand_slider" type="range" min="-20" max="20" value="0">
            <br>
            <p id="supply_shift">Supply Shift: 0</p>
            <input class="slider" id="supply_slider" type="range" min="-20" max="20" value="0">
        </div>
    </div>

    <hr class="my-4" style="width: 75%">
    <h1 class="display-4 text-center" id="cost_curve_place">Cost Curve <span class="badge badge-secondary">New</span></h1>

    <div class="graph center">
        <div class="card border-info mb-3 center-element" id ="cc_info_panel" style="width: 18rem; display: none; vertical-align: top;">
            <div class="card-header">Info</div>
            <div class="card-body text-info">
                <h5 class="card-title">Total Profit</h5>
                <p class="card-text" id="cc_total_profit">$0</p>
                <h5 class="card-title">Optimal Output</h5>
                <p class="card-text" id="cc_q">None</p>
                <h5 class="card-title">Shutdown</h5>
                <p class="card-text" id="cc_shutdown">True</p>
            </div>
        </div>
        <canvas class="center-element" id="cost_chart" width="1000" height="600" style="display: inline-block"></canvas>
    </div>
    <!-- 
    <div class="controls">
        <p id="tfc">TFC: 100</p>
        <input class="slider" id="tfc_slider" type="range" min="20" max="100" value="100">
        <br>
        <p id="tvc_growth">TVC Growth: 1</p>
        <input class="slider" id="tvc_growth_slider" type="range" min="1" max="5" value="1">
    </div>
    -->

    <!-- 
    <div class="card controls">
        <h5 class="card-header">Controls</h5>
        <div class="card-body">
            <p id="tfc">TFC: 100</p>
            <input class="slider" id="tfc_slider" type="range" min="20" max="100" value="100">
            <br>
            <p id="tvc_growth">TVC Growth: 1</p>
            <input class="slider" id="tvc_growth_slider" type="range" min="1" max="5" value="1" step=".1">
        </div>
    </div>
    -->

    <div class="card text-center controls">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs">
                <li class="nav-item">
                    <a class="nav-link active" id="cc_normal_tab" data-toggle="tab" href="#cc_normal_panel" role="tab">Cost Controls</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="cc_mrdarp_tab" data-toggle="tab" href="#cc_mrdarp_panel" role="tab">MR.DARP Controls</a>
                </li>
            </ul>
        </div>
        <div class="card-body">
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="cc_normal_panel" role="tabpanel">
                    <p id="tfc">TFC: 100</p>
                    <input class="slider" id="tfc_slider" type="range" min="20" max="100" value="100">
                    <br>
                    <p id="tvc_growth">TVC Growth: 1</p>
                    <input class="slider" id="tvc_growth_slider" type="range" min="1" max="5" value="1" step=".1">
                </div>
                <div class="tab-pane fade" id="cc_mrdarp_panel" role="tabpanel">
                    <p>Enable MR.DARP</p>
                    <input id="price_checkbox" type="checkbox">
                    <br>
                    <p id="price">Price: 10</p>
                    <input class="slider" id="price_slider" type="range" min="10" max="100" value="10">
                </div>
            </div>
        </div>
    </div>

    <style>
        canvas {
            margin: 0 auto;
        }

        .controls {
            margin: auto;
            width: 70%;
        }

        .slider {
            width: 100%;
        }
        .center {
            margin-left: auto;
            margin-right: auto;
            text-align: center;
        }
        .center-element {
            margin-left: auto;
            margin-right: auto;
            text-align: left;
        }
        
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
    <script>
        var d_slider = document.getElementById("demand_slider");
        var s_slider = document.getElementById("supply_slider");

        var supply_text = document.getElementById("supply_shift");
        var demand_text = document.getElementById("demand_shift");

        var ctx = document.getElementById('supply_vs_demand_chart');

        var chart = new Chart(ctx, {
            type: 'line',
            data: {
                "datasets": [
                    {
                        "label": "Equilibrium Point",
                        "data": [{ x: 35, y: 35 }],
                        "fill": false,
                        "pointRadius": 5,
                        "borderColor": "rgb(0, 0, 0)",
                        "pointBackgroundColor": "rgb(0, 0, 0)"
                    },
                    {
                        "label": "Supply Curve",
                        "data": generateSupplyPoints(0),
                        "fill": false,
                        "borderColor": "rgb(255, 0, 0)",
                        "pointBackgroundColor": "rgb(255, 0, 0)"
                    },
                    {
                        "label": "Demand Curve",
                        "data": generateDemandPoints(0),
                        "fill": false,
                        "borderColor": "rgb(0, 0, 255)",
                        "pointBackgroundColor": "rgb(0, 0, 255)"
                    }]
            },
            options: {
                responsive: false,
                maintainAspectRatio: false,
                scales: {
                    xAxes: [{
                        display: true,
                        type: 'linear',
                        position: 'bottom',
                        ticks: {
                            min: 0,
                            max: 70
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Quantity'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        type: 'linear',
                        position: 'bottom',
                        ticks: {
                            min: 0,
                            max: 70,
                            callback: function (value, index, values) {
                                return '$' + value;
                            }
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Price'
                        }
                    }]
                }
            }
        });



        function generateSupplyPoints(shift) {
            var list = []
            for (let i = 0; i < 8; i++) {
                list.push({ x: (i * 10.0) + parseInt(shift), y: i * 10.0 });
            }
            return list
        }
        function generateDemandPoints(shift) {
            var list = []
            for (let i = 0; i < 8; i++) {
                list.push({ x: (i * 10.0) + parseInt(shift), y: 70.0 - i * 10.0 });
            }
            return list
        }

        var supply_shift = 0;
        var demand_shift = 0;

        function updateSupplyData(new_supply_shift) {
            chart.data.datasets[1].data = generateSupplyPoints(new_supply_shift);
            //console.log("Updating supply");
            //console.log(chart.data.datasets[0].data);
            updateEquilibriumData(new_supply_shift, demand_shift);
            chart.update();
        }

        function updateDemandData(new_demand_shift) {
            chart.data.datasets[2].data = generateDemandPoints(new_demand_shift);
            //console.log("Updating demand");
            updateEquilibriumData(supply_shift, new_demand_shift);
            chart.update();
        }

        function updateEquilibriumData(new_supply_shift, new_demand_shift) {
            new_supply_shift = parseInt(new_supply_shift);
            new_demand_shift = parseInt(new_demand_shift);

            x_e = (70 + new_supply_shift + new_demand_shift) / 2.0;
            y_e = x_e - new_supply_shift;

            console.log(x_e + ", " + y_e);

            chart.data.datasets[0].data = [{ x: x_e, y: y_e }]
        }

        d_slider.oninput = function () {
            demand_text.innerHTML = "Demand Shift: " + this.value;
            demand_shift = this.value;
            updateDemandData(this.value);
        }
        s_slider.oninput = function () {
            supply_text.innerHTML = "Supply Shift: " + this.value;
            supply_shift = this.value;
            updateSupplyData(this.value);
        }
    </script>
    <script>
        var tfc_slider = document.getElementById('tfc_slider');
        var tfc_text = document.getElementById('tfc');
        var tfc = 100;

        var tvc_growth_slider = document.getElementById('tvc_growth_slider');
        var tvc_growth_text = document.getElementById('tvc_growth');
        var tvc_growth = 1;

        var price = 10;
        var price_checkbox = document.getElementById('price_checkbox');
        var price_slider = document.getElementById('price_slider');
        var price_text = document.getElementById('price');

        var cost_info_panel = document.getElementById('cc_info_panel');
        var mrdarp_enabled = false;
        var tp_text = document.getElementById('cc_total_profit');
        var q_text = document.getElementById('cc_q');
        var shutdown_text = document.getElementById('cc_shutdown');

        var cost_ctx = document.getElementById('cost_chart');

        let q_max = 40;

        var cost_chart = new Chart(cost_ctx, {
            type: 'line',
            data: {
                "datasets": [
                    {
                        "label": "MC",
                        "data": generateMCPoints(1),
                        "fill": false,
                        "pointRadius": 5,
                        "borderColor": "rgb(0, 0, 0)",
                        "pointBackgroundColor": "rgb(0, 0, 0)"
                    },
                    {
                        "label": "ATC",
                        "data": generateATCPoints(100, 1),
                        "fill": false,
                        "pointRadius": 5,
                        "borderColor": "rgb(255, 0, 0)",
                        "pointBackgroundColor": "rgb(255, 0, 0)"
                    },
                    {
                        "label": "AVC",
                        "data": generateAVCPoints(1),
                        "fill": false,
                        "pointRadius": 5,
                        "borderColor": "rgb(0, 255, 0)",
                        "pointBackgroundColor": "rgb(0, 255, 0)"
                    },
                    {
                        "label": "AFC",
                        "data": generateAFCPoints(100),
                        "fill": false,
                        "pointRadius": 5,
                        "borderColor": "rgb(255, 0, 255)",
                        "pointBackgroundColor": "rgb(255, 0, 255)"
                    }
                ]
            },
            options: {
                responsive: false,
                maintainAspectRatio: false,
                scales: {
                    xAxes: [{
                        type: 'linear',
                        position: 'bottom',
                        ticks: {
                            min: 0,
                            max: 40,
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Q'
                        }
                    }],
                    yAxes: [{
                        type: 'linear',
                        position: 'bottom',
                        ticks: {
                            min: 0,
                            max: 100,
                            callback: function (value, index, values) {
                                return '$' + value;
                            }
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Cost'
                        }
                    }]
                }
            }
        });

        function getAvg(arr) {
            return getSum(arr) / arr.length;
        }

        function getSum(arr) {
            var sum = 0.0;
            for (let i = 0; i < arr.length; i++) {
                sum += arr[i].y
            }
            return sum;
        }

        function generateAveragePoints(costs) {
            var list = [];
            for (let i = 0; i < costs.length; i++) {
                list.push({ x: i + 1, y: costs[i].y / (i + 1) });
            }
            return list;
        }

        function generateTVCPoints(costs) {
            var list = [];
            for (let i = 0; i < costs.length; i++) {
                var curr_list = costs.slice(0, i + 1);
                list.push({ x: i + 1, y: getSum(curr_list) });
            }
            return list;
        }

        function generateAVCPoints(growth) {
            return generateAveragePoints(generateTVCPoints(generateMCPoints(growth), 0));
        }

        function generateTCPoints(costs, fixed_cost) {
            var list = [];
            for (let i = 0; i < costs.length; i++) {
                var curr_list = costs.slice(0, i + 1);
                list.push({ x: i + 1, y: getSum(curr_list) + fixed_cost });
            }
            return list;
        }

        function generateATCPoints(fixed_cost, growth) {
            return generateAveragePoints(generateTCPoints(generateMCPoints(growth), fixed_cost));
        }

        function generateAFCPoints(fixed_cost) {
            var list = [];
            for (let i = 0; i < q_max; i++) {
                list.push({ x: i + 1, y: fixed_cost / (i + 1) });
            }
            return list;
        }

        function generateMrdarpPoints(price) {
            var list = [{x: 0, y:price}, {x:40, y:price}]
            return list;
        }

        function generateMCPoints(growth) {
            var list = [];
            var momentum = -10;
            list.push({ x: 1, y: 60 })
            for (let i = 0; i < q_max; i++) {
                prev_point = list[i];
                list.push({ x: prev_point.x + 1, y: prev_point.y + (momentum + (i + 1) * growth) });
            }
            return list;
        }

        function get_min_point(points) {
            min_y_value = points[0].y;
            min_x_index = 0;
            for (var i = 1; i < points.length; i++) {
                if (points[i].y < min_y_value) {
                    min_y_value = points[i].y;
                    min_x_index = i;
                }
            }
            return {x_min: min_x_index, y_min:min_y_value};
        }

        function get_nearest_point(points, target) {
            min_point = get_min_point(points);
            near_y_val = min_point.y_min;
            near_x_index = min_point.x_min;
            for (var i = min_point.x_min+1; i < points.length; i++) {
                if (Math.abs(target - points[i].y) < Math.abs(target - near_y_val)) {
                    near_y_val = points[i].y;
                    near_x_index = i;
                }
            }
            return {x_near: near_x_index, y_near:near_y_val};
        }

        function update_tfc(fixed_cost) {
            cost_chart.data.datasets[1].data = generateATCPoints(fixed_cost, tvc_growth);
            cost_chart.data.datasets[3].data = generateAFCPoints(fixed_cost);
            cost_chart.update();
        }

        function update_tvc_growth(growth) {
            cost_chart.data.datasets[0].data = generateMCPoints(growth);
            cost_chart.data.datasets[1].data = generateATCPoints(tfc, growth);
            cost_chart.data.datasets[2].data = generateAVCPoints(growth);
            cost_chart.update();
        }

        function update_mrdarp(enabled, price) {
            if (enabled) {
                if (cost_chart.data.datasets.length > 4)
                {
                    cost_chart.data.datasets[4].data = generateMrdarpPoints(price);
                }
                else {
                    mrdarp_dataset = {
                        "label": "Price",
                        "data": generateMrdarpPoints(price),
                        "fill": false,
                        "pointRadius": 5,
                        "borderColor": "rgb(0, 0, 255)",
                        "pointBackgroundColor": "rgb(0, 0, 255)"
                    }
                    cost_chart.data.datasets.push(mrdarp_dataset);
                }    
                cost_chart.update();
                var min_ATC = get_min_point(cost_chart.data.datasets[1].data);
                var min_AVC = get_min_point(cost_chart.data.datasets[2].data);
                var near_MC = get_nearest_point(cost_chart.data.datasets[0].data, price);

                if (price < min_AVC.y_min)
                {
                    shutdown_text.innerHTML = "Yes";
                    q_text.innerHTML = "0";
                    tp_text.innerHTML = "$-" + tfc;
                }
                else {
                    var q_ATC = cost_chart.data.datasets[1].data[near_MC.x_near].y

                    shutdown_text.innerHTML = "No";
                    q_text.innerHTML = near_MC.x_near+1;
                    tp_text.innerHTML =  "$" + ((near_MC.x_near+1)*price-(near_MC.x_near+1)*q_ATC);
                }
                 
            }
            else {
                if (cost_chart.data.datasets.length > 4) {
                    cost_chart.data.datasets.pop();
                }
            }
        }

        tfc_slider.oninput = function () {
            tfc_text.innerHTML = "TFC: " + this.value;
            tfc = parseInt(this.value);
            update_tfc(tfc);
            update_mrdarp(mrdarp_enabled, price);
        }
        tvc_growth_slider.oninput = function () {
            tvc_growth_text.innerHTML = "TVC Growth: " + this.value;
            tvc_growth = parseFloat(this.value);
            update_tvc_growth(tvc_growth);
            update_mrdarp(mrdarp_enabled, price);
        }
        price_slider.oninput = function () {
            price_text.innerHTML = "Price: " + this.value;
            price = parseInt(this.value);
            update_mrdarp(mrdarp_enabled, price);
        }
        price_checkbox.oninput = function () {
            if (this.checked) {
                cost_info_panel.style.display = "inline-block";
                mrdarp_enabled = true;
                update_mrdarp(mrdarp_enabled, price);
            }
            else {
                cost_info_panel.style.display = "none";
                mrdarp_enabled = false;
                update_mrdarp(mrdarp_enabled, price);
            }
        }
    </script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
</body>

</html>